{% extends 'learninghub/base_learninghub.html' %}
{% load static %}

{% block learninghub_content %}
<div class="card border-0 shadow-sm mb-4">
    <div class="card-body">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb mb-0">
                <li class="breadcrumb-item"><a href="{% url 'learninghub:course_list' %}">All Courses</a></li>
                <li class="breadcrumb-item"><a href="{% url 'learninghub:course_detail' course.id %}">{{ course.title }}</a></li>
                <li class="breadcrumb-item active" aria-current="page">{{ lesson.title }}</li>
            </ol>
        </nav>
    </div>
</div>

<div class="row">
    <div class="col-md-8">
        <div class="card border-0 shadow-sm mb-4">
            <div class="card-header bg-white border-0">
                <h3 class="mb-0">{{ lesson.title }}</h3>
            </div>
            <div class="card-body">
        <!-- Video Content (if available) -->
        {% if lesson.video_url %}
        <div class="ratio ratio-16x9 mb-4">
            <iframe src="{{ lesson.video_url }}" title="{{ lesson.title }}" allowfullscreen></iframe>
        </div>
        {% endif %}
        
        <!-- Text Content -->
        <div class="lesson-content">
            {{ lesson.content|safe }}
        </div>
        
        <!-- Completion Status -->
        <div class="mt-4 pt-3 border-top">
            {% if is_completed %}
            <div class="alert alert-success">
                <i class="mdi mdi-check-circle me-2"></i> You have completed this lesson
            </div>
            {% else %}
            <form method="post" action="">
                {% csrf_token %}
                <button type="submit" name="mark_complete" class="btn btn-primary">
                    Mark as Complete <i class="mdi mdi-check ms-1"></i>
                </button>
            </form>
            {% endif %}
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <!-- Sponsor Information -->
        {% if course.sponsor %}
        <div class="card border-0 shadow-sm mb-4">
            <div class="card-body bg-gray-100 p-2 rounded mb-4 text-center">
                <p class="text-sm text-gray-700 mb-2">This course is proudly sponsored by:</p>
                <a href="{% url 'learninghub:sponsor_detail' course.sponsor.id %}" class="text-decoration-none">
                    <img src="{{ course.sponsor.logo.url }}" alt="{{ course.sponsor.name }}" class="sponsor-logo mx-auto">
                    <h6 class="mt-2 mb-1">{{ course.sponsor.name }}</h6>
                </a>
                {% if course.sponsor.description %}
                <p class="small text-muted mb-2">{{ course.sponsor.description|truncatechars:100 }}</p>
                {% endif %}
                <div class="d-flex justify-content-center gap-2 mt-2">
                    <a href="{% url 'learninghub:sponsor_detail' course.sponsor.id %}" class="btn btn-sm btn-outline-secondary">
                        More Info
                    </a>
                    {% if course.sponsor.website %}
                    <a href="{{ course.sponsor.website }}" class="btn btn-sm btn-outline-primary" target="_blank" rel="noopener noreferrer">
                        Visit Website <i class="mdi mdi-open-in-new ms-1"></i>
                    </a>
                    {% endif %}
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</div>

<!-- Navigation Controls -->
<div class="d-flex justify-content-between mt-4">
    {% if prev_lesson %}
    <a href="{% url 'learninghub:lesson_detail' prev_lesson.id %}" class="btn btn-outline-primary">
        <i class="mdi mdi-arrow-left me-1"></i> Previous Lesson
    </a>
    {% else %}
    <a href="{% url 'learninghub:course_detail' course.id %}" class="btn btn-outline-secondary">
        <i class="mdi mdi-arrow-left me-1"></i> Back to Course
    </a>
    {% endif %}
    
    {% if next_lesson %}
    <a href="{% url 'learninghub:lesson_detail' next_lesson.id %}" class="btn btn-primary">
        Next Lesson <i class="mdi mdi-arrow-right ms-1"></i>
    </a>
    {% else %}
    <a href="{% url 'learninghub:course_detail' course.id %}" class="btn btn-success">
        Complete Course <i class="mdi mdi-check ms-1"></i>
    </a>
    {% endif %}
</div>
{% endblock %}
