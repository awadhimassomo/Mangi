{% extends 'webapp/base_webapp.html' %}

{% block title %}Mangi POS - Sales Dashboard{% endblock %}

{% block additional_styles %}
/* Calculator Styles */
.calc-btn {
    @apply text-lg font-medium w-full h-12 rounded flex items-center justify-center cursor-pointer;
}
.calc-btn-number {
    @apply bg-white hover:bg-gray-100 text-gray-800;
}
.calc-btn-operator {
    @apply bg-red-300 hover:bg-red-400 text-white;
}
.calc-btn-equals {
    @apply bg-primary hover:bg-secondary text-white;
}
.calc-btn-clear {
    @apply bg-gray-300 hover:bg-gray-400 text-gray-800;
}

/* Modal styles */
.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    z-index: 50;
    align-items: center;
    justify-content: center;
}

.modal-content {
    background-color: white;
    border-radius: 0.5rem;
    max-height: 90vh;
    overflow-y: auto;
}

/* Gradient Background */
.brand-gradient {
    background: linear-gradient(to bottom, #EE4540, #C72C41, #801336, #510A32, #20142C);
}

/* Fullscreen Layout */
.full-width {
    width: 100%;
    max-width: 100%;
    padding-left: 0;
    padding-right: 0;
}
{% endblock %}

{% block content %}
<!-- Main Content Container -->
<div class="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8">
    <!-- Dashboard Header -->
    <div class="brand-gradient rounded-lg shadow px-5 py-4 mb-6">
        <div class="flex justify-between items-center">
            <div class="flex items-center">
                <button class="text-white mr-3" aria-label="Go back">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <div>
                    <h1 class="text-2xl font-bold text-white">{{ business.businessName|default:"Your Business" }} Dashboard</h1>
                    <p class="text-white opacity-80">Manage your sales and orders</p>
                </div>
            </div>
            <div>
                <select class="bg-white bg-opacity-20 text-white border-0 rounded p-2">
                    <option value="today">Today</option>
                    <option value="week">This Week</option>
                    <option value="month" selected>This Month</option>
                </select>
            </div>
        </div>
    </div>

    <div class="flex flex-col lg:flex-row gap-6">
        <!-- Left Side - Products Area (75% width) -->
        <div class="w-full lg:w-3/4">
            <!-- Categories Tabs -->
            <div class="bg-white rounded-lg shadow mb-6 overflow-hidden">
                <div class="flex overflow-x-auto gap-2 p-2">
                    {% if categories %}
                        {% for category in categories %}
                            <button class="py-3 px-6 text-center font-medium rounded-md border-b-2 {% if forloop.first %}border-primary bg-gray-100{% else %}border-transparent hover:border-gray-300{% endif %}" aria-label="{{ category.categoryName }}">
                                {{ category.categoryName }}
                            </button>
                        {% endfor %}
                    {% else %}
                        <div class="py-3 px-6 text-center font-medium text-gray-500">
                            No categories available
                        </div>
                    {% endif %}
                </div>
            </div>

            <div class="flex-grow p-4 overflow-y-auto bg-gray-50">
                <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
                    {% if products %}
                        {% for product in products %}
                            <!-- Product Card {{ forloop.counter }} -->
                            <div class="bg-white rounded-lg shadow hover:shadow-md">
                                <div class="p-4 flex justify-center">
                                    <div class="h-28 w-28 bg-gray-100 rounded-full flex items-center justify-center">
                                    {% if product.image %}
                                        <img src="{{ product.image.url }}" alt="{{ product.product_name }}" class="h-24 w-24 object-contain">
                                    {% else %}
                                        <i class="fas fa-utensils text-primary text-2xl"></i>
                                    {% endif %}
                                    </div>
                                </div>
                                <div class="p-4 text-center">
                                    <h3 class="font-medium">{{ product.product_name }}</h3>
                                    <p class="text-gray-500 text-sm mt-1">
                                        {% if product.category %}
                                            {{ product.category.categoryName }}
                                        {% else %}
                                            Uncategorized
                                        {% endif %}
                                    </p>
                                    <p class="text-primary font-bold mt-2">TZS {{ product.price|floatformat:0|default:"0" }}</p>
                                </div>
                            </div>
                        {% endfor %}
                    {% else %}
                        <div class="col-span-full text-center py-10">
                            <i class="fas fa-box-open text-gray-300 text-5xl mb-3"></i>
                            <p class="text-gray-500">No products available</p>
                        </div>
                    {% endif %}
                    
                    <!-- More product cards can be added here -->
                </div>
            </div>
        </div>
        
        <!-- Right Side - Order Details (25% width) -->
        <div class="w-full lg:w-1/4">
            <div id="order-details" class="bg-white rounded-lg shadow">
                <div class="p-4 border-b flex justify-between items-center">
                    <h2 class="font-medium">Order Details</h2>
                    <div>
                        <button id="toggle-calculator" class="text-gray-500 hover:text-primary" aria-label="Toggle calculator">
                            <i class="fas fa-calculator"></i>
                        </button>
                        <button id="open-calculator-modal" class="text-gray-500 hover:text-primary ml-2" aria-label="Open full calculator">
                            <i class="fas fa-expand-alt"></i>
                        </button>
                    </div>
                </div>
                
                <div class="p-4">
                    <!-- Order Items -->
                    <div class="space-y-4">
                        {% if products %}
                            {% for product in products|slice:":2" %}
                                <!-- Order Item {{ forloop.counter }} -->
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center space-x-3">
                                        <div class="h-12 w-12 bg-gray-100 rounded-lg flex items-center justify-center">
                                            <i class="fas fa-utensils text-primary"></i>
                                        </div>
                                        <div>
                                            <h3 class="font-medium">{{ product.product_name }}</h3>
                                            <p class="text-xs text-gray-500">1 x TZS {{ product.price|floatformat:0 }}</p>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <p class="font-medium">TZS {{ product.price|floatformat:0 }}</p>
                                        <button class="text-gray-400 hover:text-red-500 text-sm" aria-label="Remove item">
                                            <i class="fas fa-times"></i> Remove
                                        </button>
                                    </div>
                                </div>
                            {% endfor %}
                        {% else %}
                            <div class="text-center py-4">
                                <i class="fas fa-shopping-cart text-gray-300 text-3xl mb-2"></i>
                                <p class="text-gray-500">No items in cart</p>
                            </div>
                        {% endif %}
                    </div>
                    
                    <!-- Border line -->
                    <div class="border-t my-4"></div>
                    
                    <!-- Order Summary -->
                    <div class="space-y-2">
                        {% if products %}
                        {% with first_product=products|first %}
                            <div class="flex justify-between">
                                <span class="text-gray-600">Subtotal</span>
                                <span class="font-medium">TZS {{ first_product.price|floatformat:0 }}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Tax (18%)</span>
                                <!-- For demo purpose we'll show fixed tax percentage -->
                                <span class="font-medium">TZS {{ first_product.price|floatformat:0 }}</span>
                            </div>
                            <div class="flex justify-between text-lg font-bold mt-2">
                                <span>Total</span>
                                <!-- For demo purpose we're showing full amount + estimated tax -->
                                <span class="text-primary">TZS {{ first_product.price|floatformat:0 }}</span>
                            </div>
                        {% endwith %}
                        {% else %}
                            <div class="flex justify-between">
                                <span class="text-gray-600">Subtotal</span>
                                <span class="font-medium">TZS 0</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Tax (18%)</span>
                                <span class="font-medium">TZS 0</span>
                            </div>
                            <div class="flex justify-between text-lg font-bold mt-2">
                                <span>Total</span>
                                <span class="text-primary">TZS 0</span>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Calculator (Hidden by default) -->
        <div id="calculator-container" class="w-full lg:w-1/4 hidden">
            <div class="bg-white rounded-lg shadow">
                <div class="p-4 border-b flex justify-between items-center">
                    <h2 class="font-medium">Calculator</h2>
                    <button id="toggle-calculator-back" class="text-gray-500 hover:text-primary" aria-label="Toggle back to order details">
                        <i class="fas fa-receipt"></i>
                    </button>
                </div>
                
                <div class="p-4">
                    <!-- Calculator Display -->
                    <div class="bg-gray-100 p-4 rounded-md mb-4">
                        <input type="text" id="calc-display-sidebar" class="w-full text-right text-3xl font-bold bg-transparent border-none focus:outline-none" value="0" readonly aria-label="Calculator display">
                    </div>
                    
                    <!-- Calculator Buttons -->
                    <div class="grid grid-cols-4 gap-2">
                        <div class="calc-btn calc-btn-number" onclick="appendToCalc('7')">7</div>
                        <div class="calc-btn calc-btn-number" onclick="appendToCalc('8')">8</div>
                        <div class="calc-btn calc-btn-number" onclick="appendToCalc('9')">9</div>
                        <div class="calc-btn calc-btn-operator" onclick="appendToCalc('/')">÷</div>
                        
                        <div class="calc-btn calc-btn-number" onclick="appendToCalc('4')">4</div>
                        <div class="calc-btn calc-btn-number" onclick="appendToCalc('5')">5</div>
                        <div class="calc-btn calc-btn-number" onclick="appendToCalc('6')">6</div>
                        <div class="calc-btn calc-btn-operator" onclick="appendToCalc('*')">×</div>
                        
                        <div class="calc-btn calc-btn-number" onclick="appendToCalc('1')">1</div>
                        <div class="calc-btn calc-btn-number" onclick="appendToCalc('2')">2</div>
                        <div class="calc-btn calc-btn-number" onclick="appendToCalc('3')">3</div>
                        <div class="calc-btn calc-btn-operator" onclick="appendToCalc('-')">−</div>
                        
                        <div class="calc-btn calc-btn-number" onclick="appendToCalc('0')">0</div>
                        <div class="calc-btn calc-btn-number" onclick="appendToCalc('.')">.</div>
                        <div class="calc-btn calc-btn-clear" onclick="clearCalc()">C</div>
                        <div class="calc-btn calc-btn-operator" onclick="appendToCalc('+')">+</div>
                        
                        <div class="calc-btn calc-btn-equals col-span-4" onclick="calculateResult()">=</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Calculator Modal -->
    <div id="calculator-modal" class="modal">
        <div class="modal-content p-5 max-w-6xl w-full">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-medium">Order Processing</h2>
                <button id="close-calculator-modal" class="text-gray-500 hover:text-red-500 focus:outline-none" aria-label="Close calculator">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Customer Information and Products Column -->
                <div>
                    <!-- Customer Information Section -->
                    <div class="mb-6">
                        <h3 class="text-lg font-medium mb-3">Customer Information</h3>
                        <div class="bg-white p-4 rounded-md shadow">
                            <div class="flex flex-col space-y-3">
                                <div>
                                    <label for="customer-name" class="block text-sm font-medium text-gray-700 mb-1">Customer Name</label>
                                    <input type="text" id="customer-name" name="customer-name" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary focus:border-primary" placeholder="Enter customer name">
                                </div>
                                <div>
                                    <label for="customer-phone" class="block text-sm font-medium text-gray-700 mb-1">Phone Number</label>
                                    <input type="tel" id="customer-phone" name="customer-phone" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary focus:border-primary" placeholder="Enter phone number">
                                </div>
                                <div>
                                    <label for="customer-email" class="block text-sm font-medium text-gray-700 mb-1">Email (Optional)</label>
                                    <input type="email" id="customer-email" name="customer-email" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary focus:border-primary" placeholder="Enter email address">
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Products List Section -->
                    <div>
                        <h3 class="text-lg font-medium mb-3">Order Items</h3>
                        <div class="bg-white p-4 rounded-md shadow max-h-80 overflow-y-auto">
                            <div class="space-y-4">
                                <!-- Product Item 1 -->
                                <div class="flex justify-between items-center border-b pb-3">
                                    <div class="flex items-start space-x-3">
                                        <div class="h-12 w-12 bg-gray-100 rounded-lg flex items-center justify-center">
                                            <i class="fas fa-utensils text-primary"></i>
                                        </div>
                                        <div>
                                            <h4 class="font-medium">Buffalo Wings</h4>
                                            <div class="flex space-x-3 mt-1">
                                                <div class="flex items-center border rounded-md">
                                                    <button class="px-2 py-1 text-gray-600" aria-label="Decrease quantity">-</button>
                                                    <span class="px-2">2</span>
                                                    <button class="px-2 py-1 text-gray-600" aria-label="Increase quantity">+</button>
                                                </div>
                                                <span class="text-sm text-gray-500">TZS 12,000 each</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <p class="font-medium">TZS 24,000</p>
                                    </div>
                                </div>
                                
                                <!-- Product Item 2 -->
                                <div class="flex justify-between items-center">
                                    <div class="flex items-start space-x-3">
                                        <div class="h-12 w-12 bg-gray-100 rounded-lg flex items-center justify-center">
                                            <i class="fas fa-utensils text-primary"></i>
                                        </div>
                                        <div>
                                            <h4 class="font-medium">Garlic Bread</h4>
                                            <div class="flex space-x-3 mt-1">
                                                <div class="flex items-center border rounded-md">
                                                    <button class="px-2 py-1 text-gray-600" aria-label="Decrease quantity">-</button>
                                                    <span class="px-2">1</span>
                                                    <button class="px-2 py-1 text-gray-600" aria-label="Increase quantity">+</button>
                                                </div>
                                                <span class="text-sm text-gray-500">TZS 5,000 each</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <p class="font-medium">TZS 5,000</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Calculator Column -->
                <div>
                    <h3 class="text-lg font-medium mb-3">Calculator</h3>
                    <!-- Calculator Display -->
                    <div class="bg-gray-100 p-4 rounded-md mb-4">
                        <input type="text" id="calc-display-modal" class="w-full text-right text-3xl font-bold bg-transparent border-none focus:outline-none" value="0" readonly aria-label="Calculator display">
                    </div>
                    
                    <!-- Calculator Buttons -->
                    <div class="grid grid-cols-4 gap-2">
                        <div class="calc-btn calc-btn-number" onclick="appendToCalc('7')">7</div>
                        <div class="calc-btn calc-btn-number" onclick="appendToCalc('8')">8</div>
                        <div class="calc-btn calc-btn-number" onclick="appendToCalc('9')">9</div>
                        <div class="calc-btn calc-btn-operator" onclick="appendToCalc('/')">÷</div>
                        
                        <div class="calc-btn calc-btn-number" onclick="appendToCalc('4')">4</div>
                        <div class="calc-btn calc-btn-number" onclick="appendToCalc('5')">5</div>
                        <div class="calc-btn calc-btn-number" onclick="appendToCalc('6')">6</div>
                        <div class="calc-btn calc-btn-operator" onclick="appendToCalc('*')">×</div>
                        
                        <div class="calc-btn calc-btn-number" onclick="appendToCalc('1')">1</div>
                        <div class="calc-btn calc-btn-number" onclick="appendToCalc('2')">2</div>
                        <div class="calc-btn calc-btn-number" onclick="appendToCalc('3')">3</div>
                        <div class="calc-btn calc-btn-operator" onclick="appendToCalc('-')">−</div>
                        
                        <div class="calc-btn calc-btn-number" onclick="appendToCalc('0')">0</div>
                        <div class="calc-btn calc-btn-number" onclick="appendToCalc('.')">.</div>
                        <div class="calc-btn calc-btn-clear" onclick="clearCalc()">C</div>
                        <div class="calc-btn calc-btn-operator" onclick="appendToCalc('+')">+</div>
                        
                        <div class="calc-btn calc-btn-equals col-span-4" onclick="calculateResult()">=</div>
                    </div>
                    
                    <!-- Order Summary -->
                    <div class="bg-white p-4 rounded-md shadow mt-4">
                        {% if products %}
                            {% with firstproduct=products|first %}
                                <div class="space-y-2">
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">Subtotal</span>
                                        <span class="font-medium">TZS {{ firstproduct.price|floatformat:0 }}</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">Tax (18%)</span>
                                        <span class="font-medium">TZS {{ firstproduct.price|floatformat:0 }}</span>
                                    </div>
                                    <div class="flex justify-between text-lg font-bold mt-2">
                                        <span>Total</span>
                                        <span class="text-primary">TZS {{ firstproduct.price|floatformat:0 }}</span>
                                    </div>
                                </div>
                            {% endwith %}
                        {% endif %}
                        
                        <div class="mt-4 pt-4 border-t">
                            <button class="w-full bg-primary hover:bg-secondary text-white py-2 px-4 rounded-md shadow">
                                Process Payment
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Calculator Functionality
    let currentCalcValue = '0';
    const calcDisplayModal = document.getElementById('calc-display-modal');
    const calcDisplaySidebar = document.getElementById('calc-display-sidebar');
    
    // Toggle calculator button
    document.getElementById('toggle-calculator').addEventListener('click', function() {
        const orderDetails = document.getElementById('order-details');
        const calculatorContainer = document.getElementById('calculator-container');
        
        if (calculatorContainer.classList.contains('hidden')) {
            calculatorContainer.classList.remove('hidden');
            orderDetails.classList.add('hidden');
        } else {
            calculatorContainer.classList.add('hidden');
            orderDetails.classList.remove('hidden');
        }
    });
    
    // Toggle back to order details
    document.getElementById('toggle-calculator-back').addEventListener('click', function() {
        const orderDetails = document.getElementById('order-details');
        const calculatorContainer = document.getElementById('calculator-container');
        
        calculatorContainer.classList.add('hidden');
        orderDetails.classList.remove('hidden');
    });
    
    // Modal functionality
    const calculatorModal = document.getElementById('calculator-modal');
    const openCalculatorModal = document.getElementById('open-calculator-modal');
    const closeCalculatorModal = document.getElementById('close-calculator-modal');
    
    openCalculatorModal.addEventListener('click', function() {
        calculatorModal.style.display = 'flex';
    });
    
    closeCalculatorModal.addEventListener('click', function() {
        calculatorModal.style.display = 'none';
    });
    
    // Close modal when clicking outside
    window.addEventListener('click', function(event) {
        if (event.target === calculatorModal) {
            calculatorModal.style.display = 'none';
        }
    });
    
    function appendToCalc(value) {
        if (currentCalcValue === '0' && value !== '.') {
            currentCalcValue = value;
        } else {
            currentCalcValue += value;
        }
        updateCalcDisplays();
    }
    
    function clearCalc() {
        currentCalcValue = '0';
        updateCalcDisplays();
    }
    
    function calculateResult() {
        try {
            currentCalcValue = eval(currentCalcValue).toString();
        } catch (e) {
            currentCalcValue = 'Error';
        }
        updateCalcDisplays();
    }
    
    function updateCalcDisplays() {
        if (calcDisplayModal) calcDisplayModal.value = currentCalcValue;
        if (calcDisplaySidebar) calcDisplaySidebar.value = currentCalcValue;
    }
    
    // Add your JavaScript here for handling adding items to cart, 
    // changing quantities, calculating totals, etc.
</script>
{% endblock %}